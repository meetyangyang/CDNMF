Opportunistic signals (e.g.;  WiFi;  magnetic fields;  and ambient light) have been extensively studied for low-cost indoor localization;  especially via fingerprinting. We present an automatic site survey approach to build the signal maps in space-constrained environments (e.g.;  modern office buildings). The survey can be completed by a single smartphone user during normal walking;  say;  with a little human intervention. Our approach follows the classical GraphSLAM framework: the front end constructs a pose graph by incorporating the relative motion constraints from the pedestrian dead-reckoning (PDR);  the loop-closure constraints by magnetic sequence matching with the WiFi signal similarity validation;  and the global heading constraints from the opportunistic magnetic heading measurements; and the back end generates a globally consistent trajectory via graph optimization to provide ground-truth locations for the collected signal fingerprints along the survey path. We then build the signal map (also known as fingerprint database) upon these location-labeled fingerprints by the Gaussian processes regression (GPR) for later online localization. Specifically;  we exploit the pseudowall constraints from the GPR variance map of magnetic fields and the observations of ceiling lights to correct the PDR drifts with a particle filter. We evaluate our approach on several data sets collected from both the HKUST academic building and a shopping mall. We demonstrate the real-time localization on a smartphone in an office area;  with 50th percentile accuracy of 2.30 m and 90th percentile accuracy of 3.41 m. 