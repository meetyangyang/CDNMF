A cloud computing paradigm has quickly developed and been applied widely for more than ten years. In a cloud data center;  cloud service providers offer many kinds of cloud services;  such as virtual machines (VMs);  to users. How to achieve the optimized allocation of VMs for users to satisfy the requirements of both users and providers is an important problem. To make full use of VMs for providers and ensure low makespan of user tasks;  we formulate an optimal allocation model of VMs and develop an improved differential evolution (IDE) method to solve this optimization problem;  given a batch of user tasks. We compare the proposed method with several existing methods;  such as round-robin (RR);  min-min;  and differential evolution. The experimental results show that it can more efficiently decrease the cost of cloud service providers while achieving lower makespan of user tasks than its three peers. 