The intermittency and uncertainty of the renewable energy deteriorate the stability of microgrids. In this article;  we focus on a grid-connected microgrid with the wind power and a battery energy storage system (BESS). The electricity load of the microgrid is satisfied by the power from the wind turbine;  the BESS;  and the grid;  together. The purpose is to reduce the fluctuation of grid power by charging or discharging the BESS dynamically. A Markov chain is used to depict the randomness of the wind power and the fluctuation is measured by the variance of grid power. Since the variance measurement is quadratic and nonadditive;  the dynamic optimization problem of the BESS does not fit the standard model of Markov decision processes (MDPs) and the dynamic programming (DP) is not applicable. In this article;  we introduce the sensitivity-based optimization theory to derive a difference formula to overcome this obstacle. Based on the difference formula;  an iterative optimization algorithm is developed and its efficiency is similar to the policy iteration in MDPs. The optimal scheduling policy of the BESS can be derived based on this approach. Besides;  we propose a divide-and-conquer method that is much faster than traditional methods of computing the steady-state probability distribution of the large Markov chain. The performance of our approach is verified through numerical experiments using real data. Simulation results demonstrate the efficiency of our approach. In addition;  the type selection and capacity sizing of the battery storage are also investigated;  which can provide industry guidance for the design of BESS. 