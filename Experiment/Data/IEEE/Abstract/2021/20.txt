Industry 4.0 production systems must support flexibility in various dimensions;  such as for the products to be produced;  for the production processes to be applied;  and for the available machinery. In this article;  we present a novel approach to design and control smart manufacturing systems. The approach is reactive;  that is responds to unplanned situations and implements an iterative refinement technique;  that is;  optimizes itself during runtime to better accommodate production goals. For realizing these advances;  we present a model-driven methodology and we provide a prototypical implementation of such a production system. In particular;  we employ Planning Domain Definition Language (PDDL) as our artificial intelligence environment for automated planning of production processes and combine it with one of the most prominent Industry 4.0 standards for the fundamental production system model: IEC 62264. We show how to plan the assembly of small trucks from available components and how to assign specific production operations to available production resources;  including robotic manipulators and transportation system shuttles. Results of the evaluation indicate that the presented approach is feasible and that it is able to significantly strengthen the flexibility of production systems during runtime. 